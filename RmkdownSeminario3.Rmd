---
title: "Relat√≥rio de Estat√≠stica Descritiva - Crimes"
author: "Kaio M√°ximo e Thomaz Ot√°vio"
date: "`r format(Sys.time(), '%d %B, %Y')`"
output: 
    bookdown::html_document2:
       highlight: espresso
       includes:
         in_header: "cabecalho.html"
       theme: flatly
       number_sections: true
       fig_caption: false  # üî¥ ADICIONADO AQUI PARA EVITAR DUPLICA√á√ÉO
       toc: yes
       toc_float: 
         collapsed: yes
         smooth_scroll: no
---


# Introdu√ß√£o  

Este relat√≥rio apresenta uma an√°lise descritiva dos crimes registrados em um banco de dados contendo informa√ß√µes como **natureza do crime**, **munic√≠pio**, **m√™s**, **ano**, entre outras vari√°veis. O objetivo √© fornecer insights sobre a distribui√ß√£o dos crimes ao longo do tempo e por regi√£o, utilizando estat√≠sticas descritivas, gr√°ficos e tabelas. Os dados foram obtidos no seguinte link: [Dados MG](https://dados.mg.gov.br/dataset/crimes-violentos/resource/bd02f7db-04cc-4149-98ee-e6fb2e713b04).

#  Leitura e preparo dos dados
```{r leitura_dados_bh_total, message = FALSE, warning = FALSE}
library(readr)
library(dplyr)
library(ggplot2)
library(dplyr)
library(readr)
library(kableExtra)
library(gridExtra)

# Lendo a base unificada e filtrando apenas BH
bh_total <- read_delim("crimes_unificado.csv", delim = ";", show_col_types = FALSE) %>%
  filter(municipio == "BELO HORIZONTE")

# Criar os 10 crimes com mais registros para uso posterior
top_crimes <- bh_total %>%
  group_by(natureza) %>%
  summarise(total = sum(registros), .groups = "drop") %>%
  arrange(desc(total)) %>%
  slice_max(total, n = 10)

dados_top10 <- bh_total %>%
  filter(natureza %in% top_crimes$natureza)

# Visualiza√ß√£o r√°pida
head(bh_total)



```

```{r visualizar_dados, message = FALSE, warning = FALSE}
library(kableExtra)

# Visualizando as primeiras linhas
kable(head(bh_total, 10)) %>%
  kable_classic(full_width = FALSE, html_font = "Cambria")

# N√∫mero de registros

```
# Estatistica Descretiva 

## Estat√≠sticas descritivas para cada tipo de crime

### - Tabela 3.1 ‚Äì Estat√≠sticas Descritivas dos Crimes em Belo Horizonte

```{r, echo=FALSE, message=FALSE, warning=FALSE}
library(dplyr)
library(kableExtra)

estatisticas_crimes_bh <- bh_total %>%
  group_by(natureza) %>%
  summarise(
    media = round(mean(registros), 2),
    mediana = round(median(registros), 2),
    moda = as.numeric(names(sort(table(registros), decreasing = TRUE)[1]))
  ) %>%
  arrange(desc(media))

kable(estatisticas_crimes_bh, 
      col.names = c("Natureza", "M√©dia", "Mediana", "Moda")) %>%
  kable_classic(full_width = FALSE, html_font = "Cambria") %>%
  add_footnote("Fonte: Elaborado pelos autores com dados da SEJUSP/MG.")



```
## Boxplot dos 10 Crimes Mais Frequentes

```{r boxplot_crimes_frequentes, echo=FALSE, warning=FALSE, message=FALSE}
library(ggplot2)
library(dplyr)

# Filtrar os dados sem "Roubo Consumado"
dados_sem_roubo <- dados_top10 %>%
  filter(natureza != "Roubo Consumado")

# Calcular a m√©dia por crime para desenhar o X
medias <- dados_sem_roubo %>%
  group_by(natureza) %>%
  summarise(media = mean(registros), .groups = "drop")

# Boxplot com T nos bigodes + X da m√©dia
ggplot(dados_sem_roubo, aes(x = reorder(natureza, registros, FUN = median), y = registros)) +
  geom_boxplot(fill = "skyblue", outlier.color = "red", width = 0.5) +
  geom_point(data = medias, aes(x = natureza, y = media), 
             shape = 4, size = 1, color = "black", stroke = 1.2) +  # shape 4 = "X"
  labs(title = "Boxplot (Exceto Roubo Consumado)",
       x = "Natureza do Crime", y = "Registros Mensais") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))


```

## Mediana Mensal de Crimes por Natureza (2022‚Äì2024)

```{r mediana_top10_sem_roubo, message=FALSE, warning=FALSE}
library(dplyr)
library(ggplot2)
library(lubridate)

# Garantir data como coluna para eixo X
bh_total$data_ref <- as.Date(paste0(bh_total$ano, "-", bh_total$mes, "-01"))

# Pegar os 10 crimes mais registrados
top10_crimes <- bh_total %>%
  group_by(natureza) %>%
  summarise(total = sum(registros), .groups = "drop") %>%
  arrange(desc(total)) %>%
  filter(natureza != "Roubo Consumado") %>%
  slice_max(order_by = total, n = 3)

# Filtrar os dados para os top 10 (sem Roubo Consumado)
dados_mediana <- bh_total %>%
  filter(natureza %in% top10_crimes$natureza)

# Calcular a mediana mensal por tipo de crime
mediana_mensal_top10 <- dados_mediana %>%
  group_by(natureza, data_ref) %>%
  summarise(mediana = median(registros), .groups = "drop")

# Gr√°fico
ggplot(mediana_mensal_top10, aes(x = data_ref, y = mediana, color = natureza)) +
  geom_line(size = 1.1) +
  geom_point(size = 2) +
  labs(
    title = "Evolu√ß√£o da Mediana Mensal dos 10 Crimes Mais Registrados (Exceto Roubo Consumado)",
    subtitle = "Per√≠odo: 2022 a 2024 ‚Äî Belo Horizonte",
    x = "M√™s/Ano",
    y = "Mediana dos Registros Mensais",
    color = "Natureza do Crime"
  ) +
  theme_minimal() +
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1),
    plot.title = element_text(face = "bold")
  )

```


# Probobalidade

```{r prob_crimes_frequentes, message = FALSE, warning = FALSE}
# Somando os registros reais por tipo de crime (natureza)
tabela_prob <- bh_total %>%
  group_by(natureza) %>%
  summarise(registros = sum(registros)) %>%
  mutate(probabilidade = registros / sum(registros)) %>%  # C√°lculo manual da probabilidade real
  arrange(desc(probabilidade)) %>%  # Ordena pela probabilidade (ou registros)
  slice_max(order_by = registros, n = 10)

# Exibir tabela formatada
kable(tabela_prob, col.names = c("Natureza do Crime", "Registros", "Probabilidade")) %>%
  kable_classic(full_width = FALSE, html_font = "Cambria") 



```
*Legenda:* A probabilidade de cada tipo de crime √© calculada da seguinte forma)

*P(crime)* = Frequ√™ncia do crime / Frequ√™ncia total de crimes

Ou seja, a probabilidade √© a raz√£o entre o n√∫mero de ocorr√™ncias de cada tipo de crime e o total de ocorr√™ncias de todos os crimes.

## Distribui√ß√£o Binomial ‚Äì Exemplo com Ocorr√™ncia de Estupros Consumados

```{r dist_binomial, message=FALSE, warning=FALSE}
# Par√¢metros da distribui√ß√£o binomial
n <- 10  # n√∫mero de tentativas (n√∫mero de meses)
p <- 0.12  # probabilidade de sucesso

# Filtrando os dados para "Estupro Consumado"
crime_filtro <- "Estupro Consumado"
dados_crime <- bh_total[bh_total$natureza == crime_filtro, ]

# Contagem dos registros por n√∫mero de sucessos (agrupar por m√™s e somar os registros)
contagem_mensal <- dados_crime %>%
  group_by(mes) %>%
  summarise(registros = sum(registros))

# C√°lculo das probabilidades binomiais te√≥ricas ajustadas
esperados <- rbinom(n = length(contagem_mensal$registros), size = n, prob = p)

# Gr√°fico Observados vs Esperados
p1 <- ggplot(contagem_mensal, aes(x = mes)) +
  geom_bar(aes(y = registros), stat = "identity", fill = "skyblue", color = "black", alpha = 0.7, width = 0.4, position = "dodge") +
  labs(
    title = "Observados",
    x = "N√∫mero de Sucessos",
    y = "Frequ√™ncia"
  ) +
  theme_minimal()

p2 <- ggplot(data.frame(mes = contagem_mensal$mes, esperados = esperados), aes(x = mes)) +
  geom_bar(aes(y = esperados), stat = "identity", fill = "brown", color = "black", alpha = 0.7, width = 0.4, position = "dodge") +
  labs(
    title = "Esperados",
    x = "N√∫mero de Sucessos",
    y = "Frequ√™ncia"
  ) +
  theme_minimal()

grid.arrange(p1, p2, ncol = 2)


```
 
## Distribui√ß√£o de Poisson - Probabilidade de 100 homic√≠dios em um m√™s

```{r dist_poisson, message=FALSE, warning=FALSE}

# Par√¢metros
lambda <- 90   # m√©dia mensal de homic√≠dios
k <- 100       # valor espec√≠fico desejado

# C√°lculo da probabilidade com distribui√ß√£o de Poisson
prob_poisson <- dpois(k, lambda) * 100

# Exibindo o resultado formatado
paste0("P(X = 100 homic√≠dios) = ", round(prob_poisson, 2), "%")

```
## Gr√°fico da Distribui√ß√£o de Poisson

```{r dist_poisson_grafico, message=FALSE, warning=FALSE}
library(ggplot2)

# Definir o par√¢metro Œª da distribui√ß√£o de Poisson
lambda <- 5  # Exemplo de valor de Œª (m√©dia de homic√≠dios)

# Definir os valores de homic√≠dios e as probabilidades
x_vals <- 0:20  # Ajustando o intervalo de homic√≠dios para uma gama mais apropriada
probs <- dpois(x_vals, lambda) * 100

# Criar o data frame para o gr√°fico
df_poisson <- data.frame(
  homicidios = x_vals,
  prob = probs
)

# Definir o intervalo de homic√≠dios para destaque (como compara√ß√£o)
a1 <- 3
b1 <- 7

# Gr√°fico da distribui√ß√£o de Poisson com a √°rea sombreada e linha de compara√ß√£o
ggplot(df_poisson, aes(x = homicidios, y = prob)) +
  geom_bar(stat = "identity", fill = "steelblue") +  # Barras para a distribui√ß√£o
  geom_area(data = subset(df_poisson, homicidios >= a1 & homicidios <= b1), fill = "skyblue", alpha = 0.5) + # √Årea real observada
  geom_line(aes(x = homicidios, y = prob), color = "red", size = 1.5) +  # Linha de compara√ß√£o da distribui√ß√£o de Poisson
  labs(
    title = paste0("Distribui√ß√£o de Poisson (Œª = ", lambda, ")"),
    subtitle = paste("Probabilidade observada para homic√≠dios entre", a1, "e", b1),
    x = "N√∫mero de Homic√≠dios",
    y = "Probabilidade (%)"
  ) +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))


```

## Compara√ß√£o: Distribui√ß√£o Real vs Uniforme por M√™s - Anos 2022, 2023 e 2024

```{r comparar_roubo_uniforme, message=FALSE, warning=FALSE}
library(dplyr)
library(ggplot2)
library(tidyr)

# Fun√ß√£o adaptada para apenas "Roubo Consumado"
grafico_roubo_uniforme <- function(ano_escolhido) {
  
  dados_ano <- bh_total %>%
    filter(ano == ano_escolhido, natureza == "Roubo Consumado") %>%
    group_by(mes) %>%
    summarise(registros_reais = sum(registros), .groups = "drop") %>%
    mutate(
      total_ano = sum(registros_reais),
      registros_uniforme = total_ano / 12,
      mes_nome = factor(mes, levels = 1:12, labels = month.name)
    )
  
  dados_plot <- dados_ano %>%
    select(mes_nome, registros_reais, registros_uniforme) %>%
    pivot_longer(cols = c(registros_reais, registros_uniforme),
                 names_to = "tipo", values_to = "registros")
  
  ggplot(dados_plot, aes(x = mes_nome, y = registros, fill = tipo)) +
    geom_bar(stat = "identity", position = "dodge") +
    scale_fill_manual(
      values = c("registros_reais" = "tomato", "registros_uniforme" = "skyblue"),
      labels = c("Real", "Uniforme")
    ) +
    labs(
      title = paste("Roubo Consumado: Real vs Uniforme - Ano", ano_escolhido),
      x = "M√™s",
      y = "N√∫mero de Registros",
      fill = "Distribui√ß√£o"
    ) +
    theme_minimal() +
    theme(axis.text.x = element_text(angle = 45, hjust = 1))
}

# Gerar os gr√°ficos para os tr√™s anos
grafico_roubo_uniforme(2022)
grafico_roubo_uniforme(2023)
grafico_roubo_uniforme(2024)
```

  Legenda ‚Äì Compara√ß√£o Real vs. Uniforme por M√™s

Neste gr√°fico, comparamos o n√∫mero real de **Roubos Consumados** registrados por m√™s com uma **Distribui√ß√£o Uniforme Discreta Te√≥rica**, assumindo que:

\[
P(\text{qualquer m√™s}) = \frac{1}{12} \Rightarrow \text{mesmo n√∫mero esperado de registros em todos os meses}
\]

**Distribui√ß√£o Uniforme usada:**  
O valor uniforme por m√™s foi calculado como:

\[
\text{Uniforme} = \frac{\text{Total Anual de Roubos Consumados}}{12}
\]

Isso representa um cen√°rio onde **todos os meses t√™m a mesma chance de ocorr√™ncia**.

## Tabela - Top 10 Crimes com P(X > 30 Registros por M√™s)

```{r tabela_prob_maior_30, message=FALSE, warning=FALSE}

library(dplyr)
library(tidyr)
library(purrr)
library(kableExtra)

# Seleciona os 10 crimes com mais registros
top10_crimes <- bh_total %>%
  group_by(natureza) %>%
  summarise(total_registros = sum(registros), .groups = "drop") %>%
  arrange(desc(total_registros)) %>%
  slice_head(n = 10)

# Dados mensais por crime
dados_mensais <- bh_total %>%
  filter(natureza %in% top10_crimes$natureza) %>%
  group_by(natureza, ano, mes) %>%
  summarise(registros_mes = sum(registros), .groups = "drop")

# Agrupa e aninha os dados por natureza
dados_nested <- dados_mensais %>%
  group_by(natureza) %>%
  nest()

# Aplica c√°lculos com base em limite fixo de 30 registros
tabela_final <- dados_nested %>%
  mutate(
    media_mensal = map_dbl(data, ~ mean(.x$registros_mes)),
    dp_mensal = map_dbl(data, ~ sd(.x$registros_mes)),
    prob_maior_30 = map2_dbl(media_mensal, dp_mensal, ~ 
      round(pnorm(30, mean = .x, sd = .y, lower.tail = FALSE) * 100, 2))
  ) %>%
  left_join(top10_crimes, by = "natureza") %>%
  mutate(
    media_mensal = round(media_mensal, 1),
    dp_mensal = round(dp_mensal, 1),
    prob_maior_30 = paste0(prob_maior_30, "%")
  ) %>%
  select(natureza, total_registros, media_mensal, dp_mensal, prob_maior_30)

# Exibe a tabela
kable(
  tabela_final,
  col.names = c("Natureza do Crime", "Total de Registros", 
                "M√©dia Mensal", "Desvio Padr√£o", "P(> 30 Registros)")
) %>%
  kable_classic(full_width = FALSE, html_font = "Cambria")


```
## Distribui√ß√£o Exponencial - Homic√≠dio Tentado

"Probabilidade de n√£o ocorrer um Homic√≠dio Tentado em determinados intervalos de tempo, com base na Distribui√ß√£o Exponencial."
```{r exp_homicidio_tentado, message=FALSE, warning=FALSE}

library(dplyr)
library(ggplot2)
library(kableExtra)

# Nome do crime a ser analisado
nome_crime <- "Homic√≠dio Tentado"

# Filtra dados e calcula registros mensais
dados_crime <- bh_total %>%
  filter(natureza == nome_crime) %>%
  group_by(ano, mes) %>%
  summarise(registros = sum(registros), .groups = "drop")

# Taxa m√©dia (lambda) ‚Äî utilizada na distribui√ß√£o exponencial
lambda <- mean(dados_crime$registros)

# Tempos simulados (em meses) e explica√ß√µes para apresenta√ß√£o
tempos <- c(0.10, 0.25, 0.5, 1, 2)
significados <- c("At√© ~3 dias", "At√© ~7 dias", "At√© ~15 dias", "At√© 1 m√™s", "At√© 2 meses")

# C√°lculo das probabilidades de N√ÉO ocorrer crime dentro de cada intervalo
probs <- round(exp(-lambda * tempos) * 100, 2)

# Montagem da tabela com os resultados
tabela_exp <- tibble(
  `Tempo (meses)` = tempos,
  `Significado` = significados,
  `P(N√ÉO ocorrer crime nesse tempo)` = paste0(probs, "%")
)



# Prepara√ß√£o do gr√°fico de barras
grafico_df <- tibble(
  Tempo = significados,
  Probabilidade = probs
)

# Gr√°fico de colunas com anota√ß√µes
ggplot(grafico_df, aes(x = Tempo, y = Probabilidade)) +
  geom_col(fill = "tomato") +
  geom_text(aes(label = paste0(Probabilidade, "%")), vjust = -0.5, size = 4.5) +
  labs(
    title = "Distribui√ß√£o Exponencial - Homic√≠dio Tentado em BH",
    subtitle = "Probabilidade de N√ÉO ocorrer o crime em diferentes intervalos de tempo",
    x = "Intervalo de Tempo",
    y = "Probabilidade (%)"
  ) +
  ylim(0, 100) +
  theme_minimal()



```


## Integrais com Gr√°fico - √Åreas sob as curvas



```{r integrais_com_grafico, message=FALSE, warning=FALSE}
library(ggplot2)
library(gridExtra)

# ------------ CURVA NORMAL ------------
media <- 100
desvio <- 15
a1 <- 90
b1 <- 120

# C√°lculo da distribui√ß√£o normal
x_norm <- seq(60, 140, length.out = 200)
y_norm <- dnorm(x_norm, mean = media, sd = desvio)
dados_norm <- data.frame(x = x_norm, y = y_norm)

# Probabilidade real da normal (entre 90 e 120)
prob_real_norm <- pnorm(b1, media, desvio) - pnorm(a1, media, desvio)

# Gr√°fico da curva normal com valores reais
grafico_normal <- ggplot(dados_norm, aes(x, y)) +
  geom_line() + # Linha da distribui√ß√£o normal te√≥rica
  geom_area(data = subset(dados_norm, x >= a1 & x <= b1), fill = "skyblue", alpha = 0.5) + # √Årea real
  labs(
    title = "Distribui√ß√£o Normal - Real vs Esperado",
    subtitle = paste("Probabilidade acumulada entre 90 e 120\nReal: ", round(prob_real_norm * 100, 2), "%"),
    x = "X", y = "Densidade"
  ) +
  theme_minimal()

# ------------ CURVA EXPONENCIAL ------------
lambda <- 2
a2 <- 0.25
b2 <- 1

# C√°lculo da distribui√ß√£o exponencial
x_exp <- seq(0, 2, length.out = 200)
y_exp <- dexp(x_exp, rate = lambda)
dados_exp <- data.frame(x = x_exp, y = y_exp)

# Probabilidade real da exponencial (entre 0.25 e 1)
prob_real_exp <- pexp(b2, lambda) - pexp(a2, lambda)

# Gr√°fico da curva exponencial com valores reais
grafico_exp <- ggplot(dados_exp, aes(x, y)) +
  geom_line() + # Linha da distribui√ß√£o exponencial te√≥rica
  geom_area(data = subset(dados_exp, x >= a2 & x <= b2), fill = "orange", alpha = 0.5) + # √Årea real
  labs(
    title = "Distribui√ß√£o Exponencial - Real vs Esperado",
    subtitle = paste("Probabilidade entre 0.25 e 1 m√™s\nReal: ", round(prob_real_exp * 100, 2), "%"),
    x = "X", y = "Densidade"
  ) +
  theme_minimal()

# ------------ CURVA UNIFORME CONT√çNUA ------------
a <- 0
b <- 5
a3 <- 2
b3 <- 4

# C√°lculo da distribui√ß√£o uniforme
x_uni <- seq(a, b, length.out = 100)
y_uni <- rep(1 / (b - a), 100)
dados_uni <- data.frame(x = x_uni, y = y_uni)

# Probabilidade real da uniforme (entre 2 e 4)
prob_real_uni <- (b3 - a3) / (b - a)

# Gr√°fico da curva uniforme cont√≠nua com valores reais
grafico_uniforme <- ggplot(dados_uni, aes(x, y)) +
  geom_line() + # Linha da distribui√ß√£o uniforme te√≥rica
  geom_area(data = subset(dados_uni, x >= a3 & x <= b3), fill = "palegreen3", alpha = 0.5) + # √Årea real
  labs(
    title = "Distribui√ß√£o Uniforme - Real vs Esperado",
    subtitle = paste("Probabilidade entre 2 e 4\nReal: ", round(prob_real_uni * 100, 2), "%"),
    x = "X", y = "Densidade"
  ) +
  theme_minimal()

# Mostrar os gr√°ficos lado a lado
grid.arrange(grafico_normal, grafico_exp, grafico_uniforme, ncol = 1)



```
 Legenda com os Resultados Calculados
Resultados das √Åreas sob as Curvas (Simula√ß√µes):
 Distribui√ß√£o Normal:

M√©dia: 100

Desvio Padr√£o: 15

Intervalo: 90 a 120

Probabilidade: pnorm(120, 100, 15) - pnorm(90, 100, 15)
*Resultado*: 49,87%

Distribui√ß√£o Exponencial:

Taxa Œª: 2

Intervalo de tempo: 0.25 a 1 m√™s

Probabilidade: pexp(1, 2) - pexp(0.25, 2)
*Resultado*: 47,30%

Distribui√ß√£o Uniforme Cont√≠nua:

Intervalo total: [0, 5]

Intervalo de interesse: [2, 4]

Probabilidade: 
4
‚àí
2
5
‚àí
0
5‚àí0
4‚àí2
‚Äã
 
*Resultado*: 40%

## 3. Distribui√ß√µes de Probabilidade e Testes de Ader√™ncia

---
title: "An√°lise de Distribui√ß√µes de Probabilidade - Crimes Violentos"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(ggplot2)
library(dplyr)
library(readr)
```

## Carregamento dos dados

```{r}
dados <- read_csv("crimes_violentos_unificado.csv")
head(dados)
```

## Distribui√ß√£o Binomial - Exemplo

Vamos considerar como "sucesso" quando houver pelo menos 1 registro de estupro por munic√≠pio em determinado m√™s.

```{r}
# Criar vari√°vel bin√°ria: houve ou n√£o registro
dados <- dados %>%
  mutate(estupro_ocorreu = ifelse(registros > 0, 1, 0))

# Contar n√∫mero de sucessos por m√™s
sucessos_mes <- dados %>%
  group_by(ano, mes) %>%
  summarise(sucessos = sum(estupro_ocorreu), tentativas = n())

# Visualizar
ggplot(sucessos_mes, aes(x=sucessos)) +
  geom_histogram(binwidth = 5, fill="steelblue", color="black") +
  labs(title="Distribui√ß√£o de munic√≠pios com ocorr√™ncias de estupro por m√™s",
       x="N√∫mero de sucessos", y="Frequ√™ncia")
```

## C√°lculo de Probabilidade - Distribui√ß√£o Binomial

Exemplo: Qual a probabilidade de termos exatamente 50 munic√≠pios com ocorr√™ncia de estupro, assumindo n=100 e p=0.3?

```{r}
dbinom(50, size = 100, prob = 0.3)
```

## Distribui√ß√£o Normal - Quantidade de Registros

```{r}
# M√©dia e desvio padr√£o
media_reg <- mean(dados$registros)
dp_reg <- sd(dados$registros)

# Gr√°fico
ggplot(dados, aes(x = registros)) +
  geom_histogram(aes(y = ..density..), bins = 30, fill="lightgreen", color="black") +
  stat_function(fun = dnorm, args = list(mean = media_reg, sd = dp_reg), color = "red", size=1.2) +
  labs(title = "Distribui√ß√£o Normal aproximada para os registros",
       x = "Registros", y = "Densidade")
```

## C√°lculo de Probabilidade - Distribui√ß√£o Normal

Qual a probabilidade de registros serem menores ou iguais a 3?

```{r}
pnorm(3, mean = media_reg, sd = dp_reg)
```

## Teste de Ader√™ncia - Qui-Quadrado (Binomial)

```{r}
# Frequ√™ncias observadas
obs <- table(dados$estupro_ocorreu)

# Esperadas usando p = propor√ß√£o emp√≠rica
p_emp <- mean(dados$estupro_ocorreu)
exp <- c((1-p_emp)*sum(obs), p_emp*sum(obs))

chisq.test(x = obs, p = exp/sum(exp))
```

## Teste de Ader√™ncia - Qui-Quadrado (Normal)

```{r}
# Agrupar registros em faixas
dados$faixa <- cut(dados$registros, breaks = c(-1,0,1,2,3,5,10,20, Inf))

# Frequ√™ncia observada
freq_obs <- table(dados$faixa)

# Frequ√™ncia esperada com base na normal
faixas <- c(0,1,2,3,5,10,20)
probs_esp <- diff(pnorm(faixas, mean = media_reg, sd = dp_reg))
probs_esp <- c(pnorm(0, mean = media_reg, sd = dp_reg), probs_esp, 1 - pnorm(20, mean = media_reg, sd = dp_reg))
freq_esp <- probs_esp * sum(freq_obs)

chisq.test(freq_obs, p = probs_esp)
```
# Inferecial 

## Intervalo de Confian√ßa de "Homic√≠dios Tentados" em 2022
```{r, fig.width=7, fig.height=6}

# Filtrar os dados (use um crime e ano de exemplo)
dados_ic <- bh_total %>%
  filter(natureza == "Homic√≠dio Tentado", ano == 2022)

# C√°lculo da m√©dia, desvio padr√£o e erro padr√£o
media_mensal <- dados_ic$registros
media <- mean(media_mensal)
desvio <- sd(media_mensal)
erro <- qt(0.975, df = length(media_mensal)-1) * desvio / sqrt(length(media_mensal))
z_critico <- round(qnorm(0.975), 2)  # z = 1.96 para 95%

# Limites do intervalo de confian√ßa
lim_inf <- media - erro
lim_sup <- media + erro

# Constru√ß√£o da curva normal
x_vals <- seq(media - 4*desvio, media + 4*desvio, length.out = 200)
dens <- dnorm(x_vals, mean = media, sd = desvio)
df <- data.frame(x = x_vals, y = dens)

# Plot com z cr√≠tico
library(ggplot2)
ggplot(df, aes(x = x, y = y)) +
  geom_line(color = "steelblue", size = 1.2) +
  geom_ribbon(data = subset(df, x >= lim_inf & x <= lim_sup),
              aes(ymin = 0, ymax = y), fill = "lightblue", alpha = 0.5) +
  geom_vline(xintercept = media, color = "red", linetype = "dashed", size = 1) +
  annotate("text", x = media, y = max(dens), label = paste0("M√©dia = ", round(media,2)), color = "red", vjust = -0.5, size = 4) +
  annotate("text", x = lim_inf, y = 0.015, 
           label = paste0("IC 95%: [", round(lim_inf, 2), ", ", round(lim_sup, 2), "]"),
           hjust = 0, size = 4) +
  annotate("text", x = media + 1.5*desvio, y = 0.02, 
           label = paste0("z cr√≠tico (95%) = ", z_critico),
           size = 4, color = "black") +
  labs(x = "Registros", y = "Densidade", title = "Distribui√ß√£o Normal com Intervalo de Confian√ßa (95%)") +
  theme_minimal()



# Filtrando os dados
dados_filtrados <- bh_total %>%
  filter(natureza == "Homic√≠dio Tentado", ano == 2023)

# C√°lculo do erro padr√£o
dp <- sd(dados_filtrados$registros)
n <- nrow(dados_filtrados)
erro_padrao <- dp / sqrt(n)

# Exibi√ß√£o formatada
cat("### Erro Padr√£o da M√©dia\n")
cat(paste0("Para o crime **Homic√≠dio Tentado** no ano de **2023**, o erro padr√£o da m√©dia √© aproximadamente: **", round(erro_padrao, 2), "**."))


```
## Intervalo de Confian√ßa para diferen√ßa entre duas m√©dias de "Homic√≠dios Tentados" em 2022/2023

```{r}

# Filtrar os dados para 2022 e 2023
dados_22 <- bh_total %>% filter(natureza == "Homic√≠dio Tentado", ano == 2022)
dados_23 <- bh_total %>% filter(natureza == "Homic√≠dio Tentado", ano == 2023)

# Extrair vetores de registros
x_22 <- dados_22$registros
x_23 <- dados_23$registros

# Estat√≠sticas
media_22 <- mean(x_22)
media_23 <- mean(x_23)
dp_22 <- sd(x_22)
dp_23 <- sd(x_23)
n_22 <- length(x_22)
n_23 <- length(x_23)

# Diferen√ßa entre m√©dias
dif_media <- media_22 - media_23

# Erro padr√£o da diferen√ßa
erro_dif <- sqrt((dp_22^2 / n_22) + (dp_23^2 / n_23))

# Valor cr√≠tico t (graus de liberdade aproximados via Welch)
gl <- ((dp_22^2 / n_22 + dp_23^2 / n_23)^2) / 
      ((dp_22^2 / n_22)^2 / (n_22 - 1) + (dp_23^2 / n_23)^2 / (n_23 - 1))
t_critico <- qt(0.975, df = gl)

# Intervalo de confian√ßa
lim_inf <- dif_media - t_critico * erro_dif
lim_sup <- dif_media + t_critico * erro_dif

# Constru√ß√£o da curva da diferen√ßa com IC
media_plot <- dif_media
desvio_plot <- erro_dif
x_vals <- seq(media_plot - 4*desvio_plot, media_plot + 4*desvio_plot, length.out = 200)
dens <- dnorm(x_vals, mean = media_plot, sd = desvio_plot)
df_plot <- data.frame(x = x_vals, y = dens)

# Gr√°fico
library(ggplot2)
ggplot(df_plot, aes(x = x, y = y)) +
  geom_line(color = "steelblue", size = 1.2) +
  geom_ribbon(data = subset(df_plot, x >= lim_inf & x <= lim_sup),
              aes(ymin = 0, ymax = y), fill = "lightblue", alpha = 0.5) +
  geom_vline(xintercept = media_plot, color = "red", linetype = "dashed", size = 1) +
  annotate("text", x = media_plot, y = max(dens), label = paste0("Dif. M√©dias = ", round(media_plot,2)), color = "red", vjust = -0.5, size = 4) +
  annotate("text", x = lim_inf, y = 0.015, 
           label = paste0("IC 95%: [", round(lim_inf, 2), ", ", round(lim_sup, 2), "]"),
           hjust = 0, size = 4) +
  annotate("text", x = media_plot + 1.5*desvio_plot, y = 0.02, 
           label = paste0("t cr√≠tico (95%) ‚âà ", round(t_critico, 2)),
           size = 4, color = "black") +
  labs(x = "Diferen√ßa de Registros (2022 - 2023)", y = "Densidade", 
       title = "Intervalo de Confian√ßa para a Diferen√ßa entre M√©dias (95%)") +
  theme_minimal()


```

## Teste de Hip√≥tese - Sequestro e C√°rcere Privado Consumado

```{r}
# H0: Œº = 20 (A m√©dia de registros mensais √© igual a 20)
# H1: Œº ‚â† 20 (A m√©dia de registros mensais √© diferente de 20)

# Vamos usar Œ± = 0.05 (n√≠vel de 5% de signific√¢ncia)
alfa <- 0.05

# A estat√≠stica do teste ser√° o t de Student, pois temos desvio amostral e n pequeno
# t = (xÃÑ - Œº) / (s / ‚àön)

# A regi√£o de rejei√ß√£o de H0 √©: t < -t_crit OU t > t_crit
# A regi√£o de n√£o rejei√ß√£o de H0 √©: -t_crit ‚â§ t ‚â§ t_crit

# Leitura da base e filtragem
bh_total <- read_delim("crimes_unificado.csv", delim = ";", show_col_types = FALSE) %>%
  filter(municipio == "BELO HORIZONTE",
         natureza == "Sequestro e C√°rcere Privado Consumado")

dados_mensal <- bh_total %>%
  group_by(ano, mes) %>%
  summarise(registros = sum(registros), .groups = "drop")

media_mensal <- dados_mensal$registros
media_amostral <- mean(media_mensal)
desvio_amostral <- sd(media_mensal)
n <- length(media_mensal)
media_h0 <- 20

# Estat√≠stica t
t_calc <- (media_amostral - media_h0) / (desvio_amostral / sqrt(n))

# Valor cr√≠tico
t_critico <- qt(1 - alfa/2, df = n - 1)

media_amostral
desvio_amostral
t_calc
t_critico

# Verifica se est√° na zona de rejei√ß√£o
if (abs(t_calc) > t_critico) {
  decisao <- "Rejeita H0"
} else {
  decisao <- "N√£o rejeita H0"
}
decisao

paste("Com 95% de confian√ßa, a decis√£o √©:", decisao, 
      "pois t =", round(t_calc, 3), "e o valor cr√≠tico √© ¬±", round(t_critico, 3))

## 8. Curva t com Zonas de Rejei√ß√£o (t-cr√≠tico)


# Estat√≠stica j√° calculada anteriormente
# media_amostral, media_h0, desvio_amostral, n

# Par√¢metros
media_h0 <- 20
z_critico <- qnorm(0.975)  # 1.96
media_amostral <- mean(media_mensal)
desvio_amostral <- sd(media_mensal)
n <- length(media_mensal)
erro_padrao <- desvio_amostral / sqrt(n)
z_calculado <- (media_amostral - media_h0) / erro_padrao

# Curva padr√£o
x <- seq(-4, 4, length.out = 500)
y <- dnorm(x)
df_plot <- data.frame(x = x, y = y)

# Plot
ggplot(df_plot, aes(x = x, y = y)) +
  # Zonas de rejei√ß√£o
  geom_area(data = subset(df_plot, x < -z_critico), aes(y = y), fill = "red", alpha = 0.5) +
  geom_area(data = subset(df_plot, x > z_critico), aes(y = y), fill = "red", alpha = 0.5) +
  # Curva normal
  geom_line(color = "black", size = 1.2) +
  # Linha z calculado
  geom_vline(xintercept = 2.032, color = "blue", linetype = "dashed", size = 1.2) +
  annotate("text", x = 2.032, y = 0.05,
           label = paste0(round(2.032, 3)), color = "blue", hjust = -0.2) +
  # Legenda manual (fingida com geom)
  geom_point(aes(x = -3.5, y = 0.35), color = "black") +
  annotate("text", x = -3.2, y = 0.35, label = "Distribui√ß√£o Normal Padr√£o", hjust = 0) +
  geom_rect(aes(xmin = -3.5, xmax = -3.3, ymin = 0.3, ymax = 0.32), fill = "red", alpha = 0.5) +
  annotate("text", x = -3.2, y = 0.31, label = "Zona de Rejei√ß√£o (< -1.96)", hjust = 0) +
  geom_rect(aes(xmin = -3.5, xmax = -3.3, ymin = 0.25, ymax = 0.27), fill = "red", alpha = 0.5) +
  annotate("text", x = -3.2, y = 0.26, label = "Zona de Rejei√ß√£o (> 1.96)", hjust = 0) +
  # T√≠tulo e eixos
  labs(title = "Distribui√ß√£o Normal com Zonas de Rejei√ß√£o (¬±1,96)",
       x = "Valor Z",
       y = "Densidade") +
  theme_minimal()
```

## Teste de Hip√≥tese: Diferen√ßa Sequestro e C√°rcere Privado Consumado entre M√©dias (2022 vs 2023)
```{r}
# H0: Œº2022 = Œº2023
# H1: Œº2022 ‚â† Œº2023
# N√≠vel de signific√¢ncia: 5% (Œ± = 0.05)
alfa <- 0.05

# Leitura da base e filtragem
bh_total <- read_delim("crimes_unificado.csv", delim = ";", show_col_types = FALSE) %>%
  filter(municipio == "BELO HORIZONTE",
         natureza == "Sequestro e C√°rcere Privado Consumado")

# Convers√£o
bh_total$registros <- as.numeric(bh_total$registros)

# Agrupar por m√™s para cada ano
dados_2022 <- bh_total %>%
  filter(ano == 2022) %>%
  group_by(mes) %>%
  summarise(registros = sum(registros), .groups = "drop")

dados_2023 <- bh_total %>%
  filter(ano == 2023) %>%
  group_by(mes) %>%
  summarise(registros = sum(registros), .groups = "drop")

# Par√¢metros estat√≠sticos
media_2022 <- mean(dados_2022$registros)
media_2023 <- mean(dados_2023$registros)
desvio_2022 <- sd(dados_2022$registros)
desvio_2023 <- sd(dados_2023$registros)
n_2022 <- nrow(dados_2022)
n_2023 <- nrow(dados_2023)

# Estat√≠stica z para diferen√ßa entre m√©dias
erro_padrao_diff <- sqrt((desvio_2022^2)/n_2022 + (desvio_2023^2)/n_2023)
z_calculado <- (media_2022 - media_2023) / erro_padrao_diff
z_critico <- qnorm(1 - alfa/2)

# Decis√£o
if (abs(z_calculado) > z_critico) {
  decisao <- "Rejeita H0"
} else {
  decisao <- "N√£o rejeita H0"
}

cat("M√©dia 2022:", round(media_2022, 2), "\n")
cat("M√©dia 2023:", round(media_2023, 2), "\n")
cat("Erro padr√£o da diferen√ßa:", round(erro_padrao_diff, 3), "\n")
cat("Estat√≠stica z calculada:", round(z_calculado, 3), "\n")
cat("Valor cr√≠tico z:", round(z_critico, 3), "\n")
cat("Decis√£o:", decisao, "\n")
# Dados para a curva normal padr√£o
x <- seq(-4, 4, length.out = 500)
y <- dnorm(x)
df_plot <- data.frame(x = x, y = y)

# Gr√°fico
ggplot(df_plot, aes(x = x, y = y)) +
  geom_area(data = subset(df_plot, x < -z_critico), aes(y = y), fill = "red", alpha = 0.5) +
  geom_area(data = subset(df_plot, x > z_critico), aes(y = y), fill = "red", alpha = 0.5) +
  geom_line(color = "black", size = 1.2) +
  geom_vline(xintercept = z_calculado, color = "blue", linetype = "dashed", size = 1.2) +
  annotate("text", x = z_calculado, y = 0.05,
           label = paste0("z = ", round(z_calculado, 3)), color = "blue", hjust = -0.2) +
  geom_point(aes(x = -3.5, y = 0.35), color = "black") +
  annotate("text", x = -3.2, y = 0.35, label = "Distribui√ß√£o Normal Padr√£o", hjust = 0) +
  geom_rect(aes(xmin = -3.5, xmax = -3.3, ymin = 0.3, ymax = 0.32), fill = "red", alpha = 0.5) +
  annotate("text", x = -3.2, y = 0.31, label = "Zona de Rejei√ß√£o (< -1.96)", hjust = 0) +
  geom_rect(aes(xmin = -3.5, xmax = -3.3, ymin = 0.25, ymax = 0.27), fill = "red", alpha = 0.5) +
  annotate("text", x = -3.2, y = 0.26, label = "Zona de Rejei√ß√£o (> 1.96)", hjust = 0) +
  labs(title = "Distribui√ß√£o Normal com Zonas de Rejei√ß√£o (¬±1.96)",
       subtitle = paste("Decis√£o:", decisao),
       x = "Estat√≠stica z",
       y = "Densidade") +
  theme_minimal()



```

## Regress√£o Linear Simples - Estupro Consumado


```{r}
library(dplyr)
library(ggplot2)
library(readr)
library(lubridate)

# Leitura da base e filtragem
bh_total <- read_delim("crimes_unificado.csv", delim = ";", show_col_types = FALSE) %>%
  filter(municipio == "BELO HORIZONTE",
         natureza == "Estupro Consumado")

# Preparar dados mensais com formata√ß√£o de data
estupro_mensal <- bh_total %>%
  mutate(
    registros = as.numeric(registros),
    data_ref = as.Date(paste(ano, mes, "01", sep = "-")),
    mes_ano = format(data_ref, "%b %Y")
  ) %>%
  group_by(mes_ano, data_ref) %>%
  summarise(registros = sum(registros), .groups = "drop") %>%
  arrange(data_ref)

# Criar modelo linear real
modelo <- lm(registros ~ as.numeric(data_ref), data = estupro_mensal)

# Extrair coeficientes
a <- round(coef(modelo)[1], 2)  # Intercepto
b <- round(coef(modelo)[2], 2)  # Inclina√ß√£o

# Montar a equa√ß√£o da reta
equacao <- paste0("y = ", b, "x + ", a)

equacao
# Gr√°fico atualizado com a reta real
ggplot(estupro_mensal, aes(x = data_ref, y = registros)) +
  geom_point(size = 2.5, color = "tomato") +
  geom_smooth(method = "lm", color = "blue", se = FALSE, size = 1.2) +
  annotate("text", x = as.Date("2023-01-01"), y = max(estupro_mensal$registros),
           label = "In√≠cio de 2023", angle = 90, vjust = -0.5, hjust = -0.2, color = "darkblue") +
  scale_x_date(date_labels = "%b %Y", date_breaks = "1 month") +
  labs(
    title = "Regress√£o Linear ‚Äì Estupro Consumado em BH",
    subtitle = "Com equa√ß√£o da reta baseada nos dados reais",
    x = "M√™s/Ano",
    y = "Total de Registros"
  ) +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1, size = 8))

```

# Conclus√£o

A an√°lise estat√≠stica dos crimes registrados nos permite identificar padr√µes e tend√™ncias, auxiliando na formula√ß√£o de pol√≠ticas p√∫blicas de seguran√ßa. A compara√ß√£o entre diferentes regi√µes e tipos de crimes fornece um panorama detalhado, ajudando na melhor distribui√ß√£o de recursos e estrat√©gias de combate √† criminalidade.
